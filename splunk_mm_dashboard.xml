<form theme="dark">
	<label>
		Mattermost Performance KPI Metrics
	</label>
	<fieldset submitButton="false">
		<input type="time" token="time_tok1">
			<label>
			</label>
			<default>
				<earliest>
					-24h@h
				</earliest>
				<latest>
					now
				</latest>
			</default>
		</input>
	</fieldset>
	<row>
		<panel>
			<single>
				<title>
					Max CPU utilization rate (%) *PH*
				</title>
				<search>
					<query />
					<earliest>
						$time_tok1.earliest$
					</earliest>
					<latest>
						$time_tok1.latest$
					</latest>
				</search>
				<option name="drilldown">
					none
				</option>
				<option name="trellis.enabled">
					0
				</option>
				<option name="trellis.size">
					small
				</option>
			</single>
		</panel>
		<panel>
			<single>
				<title>
					Number of messages / min
				</title>
				<search>
					<query>
						| mstats rate(mattermost_post_total) WHERE index=mmmetrics span=60s
						| stats sum(rate(mattermost_post_total))
					</query>
					<earliest>
						$time_tok1.earliest$
					</earliest>
					<latest>
						$time_tok1.latest$
					</latest>
				</search>
				<option name="drilldown">
					none
				</option>
				<option name="trellis.enabled">
					0
				</option>
				<option name="trellis.size">
					small
				</option>
			</single>
		</panel>
		<panel>
			<single>
				<title>
					Number of API errors / min
				</title>
				<search>
					<query>
						| mstats rate(mattermost_http_errors_total) WHERE index=mmmetrics span=60s
						| stats sum(rate(mattermost_http_errors_total))
					</query>
					<earliest>
						$time_tok1.earliest$
					</earliest>
					<latest>
						$time_tok1.latest$
					</latest>
				</search>
				<option name="drilldown">
					none
				</option>
				<option name="trellis.enabled">
					0
				</option>
				<option name="trellis.size">
					small
				</option>
			</single>
		</panel>
		<panel>
			<single>
				<title>
					Number of connected devices
				</title>
				<search>
					<query>
						| mstats count where index=mmmetrics metric_name=mattermost_http_websockets_total
					</query>
					<earliest>
						$time_tok1.earliest$
					</earliest>
					<latest>
						$time_tok1.latest$
					</latest>
				</search>
				<option name="drilldown">
					none
				</option>
				<option name="trellis.enabled">
					0
				</option>
				<option name="trellis.size">
					small
				</option>
			</single>
		</panel>
		<panel>
			<single>
				<title>
					Number of master DB conns
				</title>
				<search>
					<query>
						| mstats max(mattermost_db_master_connections_total) WHERE index=mmmetrics span=60s
						| stats latest
					</query>
					<earliest>
						$time_tok1.earliest$
					</earliest>
					<latest>
						$time_tok1.latest$
					</latest>
				</search>
				<option name="drilldown">
					none
				</option>
				<option name="trellis.enabled">
					0
				</option>
				<option name="trellis.size">
					small
				</option>
			</single>
		</panel>
		<panel>
			<single>
				<title>
					Server memory usage (in MB)
				</title>
				<search>
					<query>
						| mstats max(go_memstats_alloc_bytes) WHERE index=mmmetrics span=15s
						| stats latest(max(go_memstats_alloc_bytes)) as server_memory
						| eval server_memory_mb = server_memory/1024/1024
						| fields server_memory_mb
					</query>
					<earliest>
						$time_tok1.earliest$
					</earliest>
					<latest>
						$time_tok1.latest$
					</latest>
				</search>
				<option name="drilldown">
					none
				</option>
				<option name="trellis.enabled">
					0
				</option>
				<option name="trellis.size">
					small
				</option>
			</single>
		</panel>
	</row>
	<row>
		<panel>
			<title>
				Number of Message Per Second
			</title>
			<chart>
				<search>
					<query>
						| mstats rate(_value) as count WHERE index=mmmetrics AND metric_name=mattermost_post_total span=60s
					</query>
					<earliest>
						$time_tok1.earliest$
					</earliest>
					<latest>
						$time_tok1.latest$
					</latest>
					<sampleRatio>
						1000
					</sampleRatio>
				</search>
				<option name="charting.axisLabelsX.majorLabelStyle.overflowMode">
					ellipsisNone
				</option>
				<option name="charting.axisLabelsX.majorLabelStyle.rotation">
					0
				</option>
				<option name="charting.axisTitleX.visibility">
					collapsed
				</option>
				<option name="charting.axisTitleY.visibility">
					visible
				</option>
				<option name="charting.axisTitleY2.visibility">
					visible
				</option>
				<option name="charting.axisX.abbreviation">
					none
				</option>
				<option name="charting.axisX.scale">
					linear
				</option>
				<option name="charting.axisY.abbreviation">
					none
				</option>
				<option name="charting.axisY.scale">
					linear
				</option>
				<option name="charting.axisY2.abbreviation">
					none
				</option>
				<option name="charting.axisY2.enabled">
					0
				</option>
				<option name="charting.axisY2.scale">
					inherit
				</option>
				<option name="charting.chart">
					line
				</option>
				<option name="charting.chart.bubbleMaximumSize">
					50
				</option>
				<option name="charting.chart.bubbleMinimumSize">
					10
				</option>
				<option name="charting.chart.bubbleSizeBy">
					area
				</option>
				<option name="charting.chart.nullValueMode">
					gaps
				</option>
				<option name="charting.chart.showDataLabels">
					none
				</option>
				<option name="charting.chart.sliceCollapsingThreshold">
					0.01
				</option>
				<option name="charting.chart.stackMode">
					default
				</option>
				<option name="charting.chart.style">
					shiny
				</option>
				<option name="charting.drilldown">
					none
				</option>
				<option name="charting.layout.splitSeries">
					1
				</option>
				<option name="charting.layout.splitSeries.allowIndependentYRanges">
					0
				</option>
				<option name="charting.legend.labelStyle.overflowMode">
					ellipsisMiddle
				</option>
				<option name="charting.legend.mode">
					standard
				</option>
				<option name="charting.legend.placement">
					none
				</option>
				<option name="charting.lineWidth">
					2
				</option>
				<option name="trellis.enabled">
					0
				</option>
				<option name="trellis.scales.shared">
					1
				</option>
				<option name="trellis.size">
					medium
				</option>
			</chart>
		</panel>
		<panel>
			<title>
				Number of API Errors per Second
			</title>
			<chart>
				<search>
					<query>
						| mstats rate(_value) WHERE index=mmmetrics AND metric_name=mattermost_http_errors_total span=60s
					</query>
					<earliest>
						$time_tok1.earliest$
					</earliest>
					<latest>
						$time_tok1.latest$
					</latest>
					<sampleRatio>
						1000
					</sampleRatio>
				</search>
				<option name="charting.axisLabelsX.majorLabelStyle.overflowMode">
					ellipsisNone
				</option>
				<option name="charting.axisLabelsX.majorLabelStyle.rotation">
					0
				</option>
				<option name="charting.axisTitleX.visibility">
					collapsed
				</option>
				<option name="charting.axisTitleY.visibility">
					visible
				</option>
				<option name="charting.axisTitleY2.visibility">
					visible
				</option>
				<option name="charting.axisX.abbreviation">
					none
				</option>
				<option name="charting.axisX.scale">
					linear
				</option>
				<option name="charting.axisY.abbreviation">
					none
				</option>
				<option name="charting.axisY.scale">
					linear
				</option>
				<option name="charting.axisY2.abbreviation">
					none
				</option>
				<option name="charting.axisY2.enabled">
					0
				</option>
				<option name="charting.axisY2.scale">
					inherit
				</option>
				<option name="charting.chart">
					line
				</option>
				<option name="charting.chart.bubbleMaximumSize">
					50
				</option>
				<option name="charting.chart.bubbleMinimumSize">
					10
				</option>
				<option name="charting.chart.bubbleSizeBy">
					area
				</option>
				<option name="charting.chart.nullValueMode">
					gaps
				</option>
				<option name="charting.chart.showDataLabels">
					none
				</option>
				<option name="charting.chart.sliceCollapsingThreshold">
					0.01
				</option>
				<option name="charting.chart.stackMode">
					default
				</option>
				<option name="charting.chart.style">
					shiny
				</option>
				<option name="charting.drilldown">
					none
				</option>
				<option name="charting.layout.splitSeries">
					0
				</option>
				<option name="charting.layout.splitSeries.allowIndependentYRanges">
					0
				</option>
				<option name="charting.legend.labelStyle.overflowMode">
					ellipsisMiddle
				</option>
				<option name="charting.legend.mode">
					standard
				</option>
				<option name="charting.legend.placement">
					none
				</option>
				<option name="charting.lineWidth">
					2
				</option>
				<option name="trellis.enabled">
					0
				</option>
				<option name="trellis.scales.shared">
					1
				</option>
				<option name="trellis.size">
					medium
				</option>
			</chart>
		</panel>
	</row>
	<row>
		<panel>
			<title>
				Mean API Request Time (in milliseconds)
			</title>
			<chart>
				<search>
					<query>
						| mstats sum(mattermost_http_request_duration_seconds_sum) as seconds_sum sum(mattermost_http_request_duration_seconds_count) as seconds_count WHERE index=mmmetrics span=30s
						| eval rate_http = 1000* seconds_sum / seconds_count
						|  fields _time rate_http
					</query>
					<earliest>
						$time_tok1.earliest$
					</earliest>
					<latest>
						$time_tok1.latest$
					</latest>
					<sampleRatio>
						1
					</sampleRatio>
				</search>
				<option name="charting.axisLabelsX.majorLabelStyle.overflowMode">
					ellipsisNone
				</option>
				<option name="charting.axisLabelsX.majorLabelStyle.rotation">
					0
				</option>
				<option name="charting.axisTitleX.visibility">
					collapsed
				</option>
				<option name="charting.axisTitleY.visibility">
					visible
				</option>
				<option name="charting.axisTitleY2.visibility">
					visible
				</option>
				<option name="charting.axisX.abbreviation">
					none
				</option>
				<option name="charting.axisX.scale">
					linear
				</option>
				<option name="charting.axisY.abbreviation">
					none
				</option>
				<option name="charting.axisY.scale">
					linear
				</option>
				<option name="charting.axisY2.abbreviation">
					none
				</option>
				<option name="charting.axisY2.enabled">
					0
				</option>
				<option name="charting.axisY2.scale">
					inherit
				</option>
				<option name="charting.chart">
					line
				</option>
				<option name="charting.chart.bubbleMaximumSize">
					50
				</option>
				<option name="charting.chart.bubbleMinimumSize">
					10
				</option>
				<option name="charting.chart.bubbleSizeBy">
					area
				</option>
				<option name="charting.chart.nullValueMode">
					gaps
				</option>
				<option name="charting.chart.showDataLabels">
					none
				</option>
				<option name="charting.chart.sliceCollapsingThreshold">
					0.01
				</option>
				<option name="charting.chart.stackMode">
					default
				</option>
				<option name="charting.chart.style">
					shiny
				</option>
				<option name="charting.drilldown">
					none
				</option>
				<option name="charting.layout.splitSeries">
					0
				</option>
				<option name="charting.layout.splitSeries.allowIndependentYRanges">
					0
				</option>
				<option name="charting.legend.labelStyle.overflowMode">
					ellipsisMiddle
				</option>
				<option name="charting.legend.mode">
					standard
				</option>
				<option name="charting.legend.placement">
					none
				</option>
				<option name="charting.lineWidth">
					2
				</option>
				<option name="trellis.enabled">
					0
				</option>
				<option name="trellis.scales.shared">
					1
				</option>
				<option name="trellis.size">
					medium
				</option>
			</chart>
		</panel>
		<panel>
			<title>
				Number of Connections to Master Database
			</title>
			<chart>
				<search>
					<query>
						| mstats max(mattermost_db_master_connections_total) WHERE index=mmmetrics span=60s
					</query>
					<earliest>
						$time_tok1.earliest$
					</earliest>
					<latest>
						$time_tok1.latest$
					</latest>
					<sampleRatio>
						1
					</sampleRatio>
				</search>
				<option name="charting.axisLabelsX.majorLabelStyle.overflowMode">
					ellipsisNone
				</option>
				<option name="charting.axisLabelsX.majorLabelStyle.rotation">
					0
				</option>
				<option name="charting.axisTitleX.visibility">
					collapsed
				</option>
				<option name="charting.axisTitleY.visibility">
					visible
				</option>
				<option name="charting.axisTitleY2.visibility">
					visible
				</option>
				<option name="charting.axisX.abbreviation">
					none
				</option>
				<option name="charting.axisX.scale">
					linear
				</option>
				<option name="charting.axisY.abbreviation">
					none
				</option>
				<option name="charting.axisY.scale">
					linear
				</option>
				<option name="charting.axisY2.abbreviation">
					none
				</option>
				<option name="charting.axisY2.enabled">
					0
				</option>
				<option name="charting.axisY2.scale">
					inherit
				</option>
				<option name="charting.chart">
					line
				</option>
				<option name="charting.chart.bubbleMaximumSize">
					50
				</option>
				<option name="charting.chart.bubbleMinimumSize">
					10
				</option>
				<option name="charting.chart.bubbleSizeBy">
					area
				</option>
				<option name="charting.chart.nullValueMode">
					gaps
				</option>
				<option name="charting.chart.showDataLabels">
					none
				</option>
				<option name="charting.chart.sliceCollapsingThreshold">
					0.01
				</option>
				<option name="charting.chart.stackMode">
					default
				</option>
				<option name="charting.chart.style">
					shiny
				</option>
				<option name="charting.drilldown">
					none
				</option>
				<option name="charting.layout.splitSeries">
					0
				</option>
				<option name="charting.layout.splitSeries.allowIndependentYRanges">
					0
				</option>
				<option name="charting.legend.labelStyle.overflowMode">
					ellipsisMiddle
				</option>
				<option name="charting.legend.mode">
					standard
				</option>
				<option name="charting.legend.placement">
					none
				</option>
				<option name="charting.lineWidth">
					2
				</option>
				<option name="trellis.enabled">
					0
				</option>
				<option name="trellis.scales.shared">
					1
				</option>
				<option name="trellis.size">
					medium
				</option>
			</chart>
		</panel>
	</row>
	<row>
		<panel>
			<title>
				Mean Cluster Request Time (in milliseconds)
			</title>
			<chart>
				<search>
					<query>
						| mstats rate(mattermost_cluster_cluster_request_duration_seconds_sum) as seconds_sum WHERE index=mmmetrics span=60s
						| eval milliseconds_sum = 1000* seconds_sum
						|  fields _time milliseconds_sum
					</query>
					<earliest>
						$time_tok1.earliest$
					</earliest>
					<latest>
						$time_tok1.latest$
					</latest>
					<sampleRatio>
						1
					</sampleRatio>
				</search>
				<option name="charting.axisLabelsX.majorLabelStyle.overflowMode">
					ellipsisNone
				</option>
				<option name="charting.axisLabelsX.majorLabelStyle.rotation">
					0
				</option>
				<option name="charting.axisTitleX.visibility">
					collapsed
				</option>
				<option name="charting.axisTitleY.visibility">
					visible
				</option>
				<option name="charting.axisTitleY2.visibility">
					visible
				</option>
				<option name="charting.axisX.abbreviation">
					none
				</option>
				<option name="charting.axisX.scale">
					linear
				</option>
				<option name="charting.axisY.abbreviation">
					none
				</option>
				<option name="charting.axisY.scale">
					linear
				</option>
				<option name="charting.axisY2.abbreviation">
					none
				</option>
				<option name="charting.axisY2.enabled">
					0
				</option>
				<option name="charting.axisY2.scale">
					inherit
				</option>
				<option name="charting.chart">
					line
				</option>
				<option name="charting.chart.bubbleMaximumSize">
					50
				</option>
				<option name="charting.chart.bubbleMinimumSize">
					10
				</option>
				<option name="charting.chart.bubbleSizeBy">
					area
				</option>
				<option name="charting.chart.nullValueMode">
					gaps
				</option>
				<option name="charting.chart.showDataLabels">
					none
				</option>
				<option name="charting.chart.sliceCollapsingThreshold">
					0.01
				</option>
				<option name="charting.chart.stackMode">
					default
				</option>
				<option name="charting.chart.style">
					shiny
				</option>
				<option name="charting.drilldown">
					none
				</option>
				<option name="charting.layout.splitSeries">
					0
				</option>
				<option name="charting.layout.splitSeries.allowIndependentYRanges">
					0
				</option>
				<option name="charting.legend.labelStyle.overflowMode">
					ellipsisMiddle
				</option>
				<option name="charting.legend.mode">
					standard
				</option>
				<option name="charting.legend.placement">
					none
				</option>
				<option name="charting.lineWidth">
					2
				</option>
				<option name="trellis.enabled">
					0
				</option>
				<option name="trellis.scales.shared">
					1
				</option>
				<option name="trellis.size">
					medium
				</option>
			</chart>
		</panel>
		<panel>
			<title>
				Number of Connections to Read Replica Databases
			</title>
			<chart>
				<search>
					<query>
						| mstats avg(mattermost_db_read_replica_connections_total) WHERE index=mmmetrics span=30s
					</query>
					<earliest>
						$time_tok1.earliest$
					</earliest>
					<latest>
						$time_tok1.latest$
					</latest>
					<sampleRatio>
						1
					</sampleRatio>
				</search>
				<option name="charting.axisLabelsX.majorLabelStyle.overflowMode">
					ellipsisNone
				</option>
				<option name="charting.axisLabelsX.majorLabelStyle.rotation">
					0
				</option>
				<option name="charting.axisTitleX.visibility">
					collapsed
				</option>
				<option name="charting.axisTitleY.visibility">
					visible
				</option>
				<option name="charting.axisTitleY2.visibility">
					visible
				</option>
				<option name="charting.axisX.abbreviation">
					none
				</option>
				<option name="charting.axisX.scale">
					linear
				</option>
				<option name="charting.axisY.abbreviation">
					none
				</option>
				<option name="charting.axisY.scale">
					linear
				</option>
				<option name="charting.axisY2.abbreviation">
					none
				</option>
				<option name="charting.axisY2.enabled">
					0
				</option>
				<option name="charting.axisY2.scale">
					inherit
				</option>
				<option name="charting.chart">
					line
				</option>
				<option name="charting.chart.bubbleMaximumSize">
					50
				</option>
				<option name="charting.chart.bubbleMinimumSize">
					10
				</option>
				<option name="charting.chart.bubbleSizeBy">
					area
				</option>
				<option name="charting.chart.nullValueMode">
					gaps
				</option>
				<option name="charting.chart.showDataLabels">
					none
				</option>
				<option name="charting.chart.sliceCollapsingThreshold">
					0.01
				</option>
				<option name="charting.chart.stackMode">
					default
				</option>
				<option name="charting.chart.style">
					shiny
				</option>
				<option name="charting.drilldown">
					none
				</option>
				<option name="charting.layout.splitSeries">
					0
				</option>
				<option name="charting.layout.splitSeries.allowIndependentYRanges">
					0
				</option>
				<option name="charting.legend.labelStyle.overflowMode">
					ellipsisMiddle
				</option>
				<option name="charting.legend.mode">
					standard
				</option>
				<option name="charting.legend.placement">
					none
				</option>
				<option name="charting.lineWidth">
					2
				</option>
				<option name="trellis.enabled">
					0
				</option>
				<option name="trellis.scales.shared">
					1
				</option>
				<option name="trellis.size">
					medium
				</option>
			</chart>
		</panel>
	</row>
	<row>
		<panel>
			<title>
				*BAD* CPU Utilization Rate (%)
			</title>
			<chart>
				<search>
					<query>
						| mstats rate(mattermost_process_cpu_seconds_total) as cpu_seconds WHERE index=mmmetrics span=30s
						| eval cpu_rate = 100* cpu_seconds
						|  fields _time cpu_rate
					</query>
					<earliest>
						$time_tok1.earliest$
					</earliest>
					<latest>
						$time_tok1.latest$
					</latest>
					<sampleRatio>
						1
					</sampleRatio>
				</search>
				<option name="charting.axisLabelsX.majorLabelStyle.overflowMode">
					ellipsisNone
				</option>
				<option name="charting.axisLabelsX.majorLabelStyle.rotation">
					0
				</option>
				<option name="charting.axisTitleX.visibility">
					collapsed
				</option>
				<option name="charting.axisTitleY.visibility">
					visible
				</option>
				<option name="charting.axisTitleY2.visibility">
					visible
				</option>
				<option name="charting.axisX.abbreviation">
					none
				</option>
				<option name="charting.axisX.scale">
					linear
				</option>
				<option name="charting.axisY.abbreviation">
					none
				</option>
				<option name="charting.axisY.scale">
					linear
				</option>
				<option name="charting.axisY2.abbreviation">
					none
				</option>
				<option name="charting.axisY2.enabled">
					0
				</option>
				<option name="charting.axisY2.scale">
					inherit
				</option>
				<option name="charting.chart">
					line
				</option>
				<option name="charting.chart.bubbleMaximumSize">
					50
				</option>
				<option name="charting.chart.bubbleMinimumSize">
					10
				</option>
				<option name="charting.chart.bubbleSizeBy">
					area
				</option>
				<option name="charting.chart.nullValueMode">
					gaps
				</option>
				<option name="charting.chart.showDataLabels">
					none
				</option>
				<option name="charting.chart.sliceCollapsingThreshold">
					0.01
				</option>
				<option name="charting.chart.stackMode">
					default
				</option>
				<option name="charting.chart.style">
					shiny
				</option>
				<option name="charting.drilldown">
					none
				</option>
				<option name="charting.layout.splitSeries">
					0
				</option>
				<option name="charting.layout.splitSeries.allowIndependentYRanges">
					0
				</option>
				<option name="charting.legend.labelStyle.overflowMode">
					ellipsisMiddle
				</option>
				<option name="charting.legend.mode">
					standard
				</option>
				<option name="charting.legend.placement">
					none
				</option>
				<option name="charting.lineWidth">
					2
				</option>
				<option name="trellis.enabled">
					0
				</option>
				<option name="trellis.scales.shared">
					1
				</option>
				<option name="trellis.size">
					medium
				</option>
			</chart>
		</panel>
		<panel>
			<title>
				Number of Go Routines
			</title>
			<chart>
				<search>
					<query>
						| mstats sum(go_goroutines) WHERE index=mmmetrics span=5s
					</query>
					<earliest>
						$time_tok1.earliest$
					</earliest>
					<latest>
						$time_tok1.latest$
					</latest>
					<sampleRatio>
						1
					</sampleRatio>
				</search>
				<option name="charting.axisLabelsX.majorLabelStyle.overflowMode">
					ellipsisNone
				</option>
				<option name="charting.axisLabelsX.majorLabelStyle.rotation">
					0
				</option>
				<option name="charting.axisTitleX.visibility">
					collapsed
				</option>
				<option name="charting.axisTitleY.visibility">
					visible
				</option>
				<option name="charting.axisTitleY2.visibility">
					visible
				</option>
				<option name="charting.axisX.abbreviation">
					none
				</option>
				<option name="charting.axisX.scale">
					linear
				</option>
				<option name="charting.axisY.abbreviation">
					none
				</option>
				<option name="charting.axisY.scale">
					linear
				</option>
				<option name="charting.axisY2.abbreviation">
					none
				</option>
				<option name="charting.axisY2.enabled">
					0
				</option>
				<option name="charting.axisY2.scale">
					inherit
				</option>
				<option name="charting.chart">
					line
				</option>
				<option name="charting.chart.bubbleMaximumSize">
					50
				</option>
				<option name="charting.chart.bubbleMinimumSize">
					10
				</option>
				<option name="charting.chart.bubbleSizeBy">
					area
				</option>
				<option name="charting.chart.nullValueMode">
					gaps
				</option>
				<option name="charting.chart.showDataLabels">
					none
				</option>
				<option name="charting.chart.sliceCollapsingThreshold">
					0.01
				</option>
				<option name="charting.chart.stackMode">
					default
				</option>
				<option name="charting.chart.style">
					shiny
				</option>
				<option name="charting.drilldown">
					none
				</option>
				<option name="charting.layout.splitSeries">
					0
				</option>
				<option name="charting.layout.splitSeries.allowIndependentYRanges">
					0
				</option>
				<option name="charting.legend.labelStyle.overflowMode">
					ellipsisMiddle
				</option>
				<option name="charting.legend.mode">
					standard
				</option>
				<option name="charting.legend.placement">
					none
				</option>
				<option name="charting.lineWidth">
					2
				</option>
				<option name="trellis.enabled">
					0
				</option>
				<option name="trellis.scales.shared">
					1
				</option>
				<option name="trellis.size">
					medium
				</option>
			</chart>
		</panel>
	</row>
</form>
